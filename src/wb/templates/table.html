<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart', 'table']});
      google.charts.setOnLoadCallback(drawcharts);

      function drawcharts(){
        {%-for chart_conf in chartdata %}
            var data = new google.visualization.DataTable();

            {%- for column in chart_conf['columns'] %}
              data.addColumn({{ column|tojson|safe }});
            {%- endfor %}
            data.addRows([
              {%- for row in chart_conf['data'] %}
                {{ row|tojson|safe }},
              {%- endfor %}
            ]);

            {%- for chart, options in  chart_conf['types'].items() %}
              var options = {{ options|tojson|safe }};
              var {{ [chart_conf['id'], chart]|join('_') }} = new google.visualization.{{chart}}(document.getElementById("{{ [chart_conf['id'], chart]|join('_') }}"));
              {{ [chart_conf['id'], chart]|join('_') }}.draw(data, options);
            {%- endfor %}
        {%- endfor %}
      }
    </script>
  </head>
  <body>
    {%- for chart_conf in chartdata %}
        {%- for chart, options in chart_conf['types'].items() %}
          <div id="{{ [chart_conf['id'], chart]|join('_') }}" style="width: 900px; height: 500px"></div>
        {%- endfor %}
    {%- endfor %}
  </body>
</html>
